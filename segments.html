<!DOCTYPE html>
<html lang="en">

<head>
    <title>M-Trada</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
</head>

<body class="app">
    <header>
        <div class="container">
            <nav class="navbar navbar-expand-lg">
                <a class="navbar-brand" href="#">M-Trada</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Link</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Dropdown
                </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                <a class="dropdown-item" href="#">Action</a>
                                <a class="dropdown-item" href="#">Another action</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#">Something else here</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link disabled" href="#">Disabled</a>
                        </li>
                    </ul>
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Username
                </a>
                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                                <a class="dropdown-item" href="#">Action</a>
                                <a class="dropdown-item" href="#">Another action</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#">Something else here</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
    </header>

    <div class="main-content">
        <div class="container">
            <h1 class="page-title">Mark Segments</h1>

            <section>
                <div class="row">
                    <div class="col-md-7">
                        <div class="card">
                            <div class="card-header map-toolbar">
                                <button class="btn btn-primary btn-add float-right" id="btnRoute">Draw Route</button>
                                <button class="btn btn-primary btn-add float-right" id="btnAddSegment">Add New</button>
                            </div>
                            <div class="card-body">
                                <div id="map"></div>
                                <div class="form-group">

                                    <label class="control-label">Origin</label>
                                    <div class="row">

                                        <div class="col-6">
                                            <div class="input-group mb-3">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">Longitude</span>
                                                </div>
                                                <input type="text" class="form-control" id="ori-lon">
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="input-group mb-3">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">Latitude</span>
                                                </div>
                                                <input type="text" class="form-control" id="ori-lat">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">

                                    <label class="control-label">Destination</label>
                                    <div class="row">

                                        <div class="col-6">
                                            <div class="input-group mb-3">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">Longitude</span>
                                                </div>
                                                <input type="text" class="form-control" id="des-lon">
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="input-group mb-3">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">Latitude</span>
                                                </div>
                                                <input type="text" class="form-control" id="des-lat">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="col-md-5">
                        <table id="tbl-segments" class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Segment</th>
                                    <th>Origin</th>
                                    <th>Destination</th>
                                </tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table>
                    
                    </div>
                </div>
            </section>
        </div>
    </div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
    <script type="text/javascript" src="libs/gmaps/gmaps.js"></script>
    <script type="text/javascript">
        var map;
        var origin = null,
            destin = null,
            segment = 2;
        var segmentIndex = 0;
        $(document).ready(function() {
            map = new GMaps({
                el: '#map',
                lat: -12.043333,
                lng: -77.028333
            });

            GMaps.on('click', map.map, function(event) {
                var index = map.markers.length;
                var lat = event.latLng.lat();
                var lng = event.latLng.lng();

                if (segment < 2) {
                    console.log(segment);
                    if (origin === null && destin === null && segment < 1) {
                        
                        $("#ori-lat").val(lat);
                        $("#ori-lon").val(lng);
                        origin = [lat, lng];
                        // alert(origin);
                        segment = 1;
                        map.addMarker({
                            lat: lat,
                            lng: lng,
                            title: 'Origin'
                        });
                        map.drawOverlay({
                          lat: lat,
                          lng: lng,
                          content: '<div class="marker-label"> ' + segmentIndex + ' </div>'
                        });
                    } else if (origin != null && destin === null && segment == 1) {
                        $("#des-lat").val(lat);
                        $("#des-lon").val(lng);
                        destin = [lat, lng];
                        map.addMarker({
                            lat: lat,
                            lng: lng,
                            title: 'Destination'
                        });
                        map.drawOverlay({
                          lat: lat,
                          lng: lng,
                          content: '<div class="marker-label"> ' + segmentIndex + ' </div>'
                        });
                        console.log("Segment -- " + origin + "---" + destin);
                        var formatOrigin = origin.join(', ');
                        var formatDestin = destin.join(', ');
                        $("#tbl-segments tbody").append("<tr class='table-active'><td>" + segmentIndex + "</td><td>" + formatOrigin + "</td><td>" + formatDestin + "</td></tr>");
                        
                        $("#btnAddSegment").removeAttr('disabled');
                    }

                }

            });

           
            map.setContextMenu({
                control: 'marker',
                options: [{
                    title: 'Center here',
                    name: 'center_here',
                    action: function(e) {
                        this.setCenter(e.latLng.lat(), e.latLng.lng());
                    }
                }]
            });

            $("#btnAddSegment").click(function() {
                segmentIndex++;
                segment = 0;
                origin = null;
                destin = null;
                map.removeMarkers();
                map.removeOverlays();
                $("#tbl-segments tr.table-active").removeClass("table-active");
                 $("#btnAddSegment").attr("disabled", "disabled");
            });

            $("#btnRoute").click(function() {
                map.drawRoute({
                    origin: origin,
                    destination: destin,
                    travelMode: 'driving',
                    strokeColor: '#ff0000',
                    strokeOpacity: 0.6,
                    strokeWeight: 6
                });
            });
        });

    </script>
</body>

</html>
